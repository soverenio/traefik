version: "3"

services:
  backend:
    image: nginx
    expose:
      - "8080"
    volumes:
      - ./backend.conf:/etc/nginx/conf.d/backend.conf
  proxy:
    image: soveren/traefik-exp:local
    build:
      context: ..
      dockerfile: exp.Dockerfile
    ports:
      - "8090:8090"
    environment:
      TRAEFIK_LOG_LEVEL: INFO
      TRAEFIK_PROVIDERS_FILE_DIRECTORY: /etc/traefik/conf/conf.d/
      TRAEFIK_ENTRYPOINTS_WEB_ADDRESS: ":8090"
    volumes:
      - ./traefik_configs:/etc/traefik/conf
  zookeeper:
    image: bitnami/zookeeper:3.7
    expose:
      - "2181"
    environment:
      ALLOW_ANONYMOUS_LOGIN: "yes"
    volumes:
      - "zookeeper_data:/bitnami"
  kafka:
    image: bitnami/kafka:2
    expose:
     - "9092"
    environment:
      KAFKA_CFG_ZOOKEEPER_CONNECT: zookeeper:2181
      ALLOW_PLAINTEXT_LISTENER: "yes"
    volumes:
      - "kafka_data:/bitnami"

volumes:
  zookeeper_data:
    driver: local
  kafka_data:
    driver: local
